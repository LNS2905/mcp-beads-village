{"id":"mcp-beads-village-2ks","title":"Beads Viewer Integration - TUI Dashboard and Robot API","description":"Tích hợp Beads Viewer (bv) vào MCP Beads Village để cung cấp:\n\n## Mục tiêu\n1. **Robot API** - Pre-computed graph insights cho AI agents (insights, plan, priority, diff)\n2. **TUI Dashboard** - Visual interface cho human operators xem trạng thái team\n\n## Architecture\n```\n┌─────────────────────────────────────────────────────────────┐\n│                    MCP Beads Village                         │\n├─────────────────────────────────────────────────────────────┤\n│  Existing Tools          │  New bv Tools                    │\n│  ─────────────           │  ─────────────                   │\n│  init, claim, done       │  bv_insights (robot-insights)    │\n│  reserve, release        │  bv_plan (robot-plan)            │\n│  msg, inbox, broadcast   │  bv_priority (robot-priority)    │\n│  ls, show, add           │  bv_graph (dependency viz)       │\n│                          │  bv_tui (launch dashboard)       │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│                     bv Binary (Go)                           │\n│  - Graph analysis: PageRank, Betweenness, HITS, etc.        │\n│  - Robot mode: JSON output for agents                        │\n│  - TUI mode: Interactive dashboard                           │\n└─────────────────────────────────────────────────────────────┘\n```\n\n## Workflow với TUI\n1. Human chạy `bv_tui()` hoặc auto-start khi leader `init()`\n2. TUI hiển thị: Kanban board, dependency graph, insights\n3. TUI watch `.beads/beads.jsonl` và auto-refresh\n4. Agents dùng Robot API tools để lấy insights (không block TUI)\n\n## Performance\n- bv chạy như subprocess riêng biệt\n- Robot mode: one-shot execution (~50ms)\n- TUI mode: persistent process, không ảnh hưởng MCP\n- MCP server vẫn chạy độc lập","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-09T19:34:49.3060732+07:00","updated_at":"2025-12-09T19:49:08.8646033+07:00","closed_at":"2025-12-09T19:49:08.8646033+07:00"}
{"id":"mcp-beads-village-3jn","title":"Add tests for bv integration","description":"## Task\nAdd tests cho bv integration\n\n## Test Cases\n\n### 1. BvManager Tests\n```python\n# tests/test_bv_manager.py\n\ndef test_get_bv_path_when_installed():\n    '''Should return path when bv in PATH'''\n\ndef test_get_bv_path_fallback():\n    '''Should check local cache'''\n\ndef test_run_robot_insights():\n    '''Should parse robot-insights JSON'''\n\ndef test_run_robot_timeout():\n    '''Should handle timeout gracefully'''\n```\n\n### 2. MCP Tools Tests\n```python\ndef test_bv_insights_tool():\n    '''Should call bv --robot-insights'''\n\ndef test_bv_tui_launches():\n    '''Should launch TUI without blocking'''\n\ndef test_graceful_fallback():\n    '''Should return error when bv not available'''\n```\n\n## Dependencies\n- All implementation tasks completed\n\n## Acceptance\n- [ ] Unit tests for BvManager\n- [ ] Integration tests for MCP tools\n- [ ] Tests pass on CI","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T19:36:03.2015498+07:00","updated_at":"2025-12-09T19:48:59.9096897+07:00","closed_at":"2025-12-09T19:48:59.9096897+07:00","dependencies":[{"issue_id":"mcp-beads-village-3jn","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:36:03.4117566+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-8st","title":"Auto-start TUI on leader init","description":"## Task\nTự động start TUI khi leader agent init()\n\n## Requirements\n1. Thêm option `start_tui: bool = False` vào init()\n2. Nếu leader=True và start_tui=True, auto launch TUI\n3. TUI chạy background, không block init\n\n## Implementation\n```python\n@mcp.tool()\ndef init(\n    ws: str = None,\n    team: str = None,\n    role: str = None,\n    leader: bool = False,\n    start_tui: bool = False  # NEW\n):\n    # ... existing init code ...\n    \n    if leader and start_tui:\n        bv_manager.start_tui(auto_refresh=True)\n    \n    return result\n```\n\n## Use Case\nLeader agent bắt đầu session và human operator muốn theo dõi:\n```\ninit(leader=True, start_tui=True)\n```\n→ TUI popup cho human xem trạng thái team\n\n## Dependencies\n- Task: Add bv_tui tool\n\n## Acceptance\n- [ ] start_tui option added to init()\n- [ ] TUI auto-starts when leader + start_tui\n- [ ] No impact if bv not available","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T19:35:43.960142+07:00","updated_at":"2025-12-09T19:44:33.766839+07:00","closed_at":"2025-12-09T19:44:33.766839+07:00","dependencies":[{"issue_id":"mcp-beads-village-8st","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:35:44.2229404+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-hjx","title":"Add Robot API wrapper functions","description":"## Task\nWrap các bv robot commands thành Python functions\n\n## Robot Commands\n| Command | Purpose |\n|---------|---------|\n| `--robot-insights` | Graph metrics (PageRank, Betweenness, cycles) |\n| `--robot-plan` | Parallel execution tracks |\n| `--robot-priority` | Priority recommendations |\n| `--robot-diff` | Changes between git revisions |\n| `--robot-recipes` | Available filter presets |\n\n## Implementation\n```python\n# beads_village/bv_manager.py\n\ndef get_insights(self) -\u003e dict:\n    '''Get graph analysis insights'''\n    return self.run_robot('--robot-insights')\n\ndef get_plan(self) -\u003e dict:\n    '''Get parallel execution plan'''\n    return self.run_robot('--robot-plan')\n\ndef get_priority(self) -\u003e dict:\n    '''Get priority recommendations'''\n    return self.run_robot('--robot-priority')\n\ndef get_diff(self, since: str = None, as_of: str = None) -\u003e dict:\n    '''Get changes between revisions'''\n    args = ['--robot-diff']\n    if since:\n        args.extend(['--diff-since', since])\n    if as_of:\n        args.extend(['--as-of', as_of])\n    return self.run_robot(args)\n```\n\n## Dependencies\n- Task: Create bv_manager.py module\n\n## Acceptance\n- [ ] All robot commands wrapped\n- [ ] JSON parsing works correctly\n- [ ] Error handling for missing data","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T19:35:16.3486188+07:00","updated_at":"2025-12-09T19:44:31.6988016+07:00","closed_at":"2025-12-09T19:44:31.6988016+07:00","dependencies":[{"issue_id":"mcp-beads-village-hjx","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:35:16.4917084+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-jvk","title":"Install bv binary and setup detection","description":"## Task\nTạo mechanism để detect và install bv binary\n\n## Requirements\n1. Check nếu `bv` đã có trong PATH\n2. Nếu không có, download từ GitHub releases\n3. Support platforms: Windows, macOS, Linux\n4. Cache binary trong `.beads-village/bin/`\n\n## Implementation\n```python\n# beads_village/bv_manager.py\nimport shutil\nimport platform\nimport subprocess\n\ndef get_bv_path():\n    # 1. Check PATH\n    bv = shutil.which('bv')\n    if bv:\n        return bv\n    \n    # 2. Check local cache\n    local_bv = Path('.beads-village/bin/bv')\n    if local_bv.exists():\n        return str(local_bv)\n    \n    # 3. Download if needed\n    return download_bv()\n\ndef download_bv():\n    # Download from GitHub releases\n    # https://github.com/Dicklesworthstone/beads_viewer/releases\n    pass\n```\n\n## Acceptance\n- [ ] bv binary detected hoặc downloaded\n- [ ] Works on Windows, macOS, Linux\n- [ ] Version check: `bv --version`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T19:35:15.6479125+07:00","updated_at":"2025-12-09T19:40:34.3612273+07:00","closed_at":"2025-12-09T19:40:34.3612273+07:00","dependencies":[{"issue_id":"mcp-beads-village-jvk","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:35:15.7796866+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-qj5","title":"Add MCP tools for bv insights plan priority graph","description":"## Task\nThêm các MCP tools mới để expose bv functionality cho AI agents\n\n## New Tools\n\n### 1. bv_insights\n```python\n@mcp.tool()\ndef bv_insights():\n    '''Get graph analysis insights: bottlenecks, keystones, cycles'''\n    return bv_manager.get_insights()\n```\n\n### 2. bv_plan  \n```python\n@mcp.tool()\ndef bv_plan():\n    '''Get parallel execution plan with tracks'''\n    return bv_manager.get_plan()\n```\n\n### 3. bv_priority\n```python\n@mcp.tool()\ndef bv_priority(limit: int = 5):\n    '''Get priority recommendations based on graph analysis'''\n    return bv_manager.get_priority(limit)\n```\n\n### 4. bv_graph\n```python\n@mcp.tool()\ndef bv_graph(issue_id: str = None):\n    '''Get dependency graph (ASCII or Mermaid)'''\n    return bv_manager.get_graph(issue_id)\n```\n\n## Integration\n- Tools chỉ available khi bv binary detected\n- Graceful fallback nếu bv không có\n\n## Dependencies\n- Task: Add Robot API wrapper functions\n\n## Acceptance\n- [ ] 4 new MCP tools registered\n- [ ] Tools return parsed JSON\n- [ ] Error handling nếu bv not available","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T19:35:42.7318199+07:00","updated_at":"2025-12-09T19:44:32.375127+07:00","closed_at":"2025-12-09T19:44:32.375127+07:00","dependencies":[{"issue_id":"mcp-beads-village-qj5","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:35:42.9491485+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-r38","title":"Add bv_tui tool for TUI launcher","description":"## Task\nThêm tool để launch TUI dashboard\n\n## Requirements\n1. Launch TUI trong terminal mới (không block MCP)\n2. Support Windows (start), macOS (open), Linux (xterm)\n3. Track TUI process để có thể stop\n\n## Implementation\n```python\n@mcp.tool()\ndef bv_tui(auto_refresh: bool = True):\n    '''Launch Beads Viewer TUI dashboard in new terminal'''\n    return bv_manager.start_tui(auto_refresh)\n```\n\n### Platform-specific launch\n```python\ndef start_tui(self, auto_refresh: bool = True) -\u003e dict:\n    if sys.platform == 'win32':\n        # start cmd /c bv\n        subprocess.Popen(['start', 'cmd', '/c', self.bv_path], shell=True)\n    elif sys.platform == 'darwin':\n        # open -a Terminal bv\n        subprocess.Popen(['open', '-a', 'Terminal', self.bv_path])\n    else:\n        # xterm -e bv \u0026\n        subprocess.Popen(['xterm', '-e', self.bv_path])\n    \n    return {'ok': 1, 'message': 'TUI launched'}\n```\n\n## Dependencies\n- Task: Create bv_manager.py module\n\n## Acceptance\n- [ ] TUI launches in new terminal window\n- [ ] Works on Windows, macOS, Linux\n- [ ] MCP server not blocked","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T19:35:43.3126719+07:00","updated_at":"2025-12-09T19:44:33.0971915+07:00","closed_at":"2025-12-09T19:44:33.0971915+07:00","dependencies":[{"issue_id":"mcp-beads-village-r38","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:35:43.5197263+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-xjs","title":"Create bv_manager.py module","description":"## Task\nTạo module quản lý bv binary và subprocess execution\n\n## Requirements\n1. Binary management (get_bv_path, ensure_bv)\n2. Subprocess execution với timeout\n3. JSON output parsing\n4. Error handling\n\n## Implementation\n```python\n# beads_village/bv_manager.py\n\nclass BvManager:\n    def __init__(self, workspace: str):\n        self.workspace = workspace\n        self.bv_path = None\n        self._tui_process = None\n    \n    def ensure_bv(self) -\u003e str:\n        '''Ensure bv is available, download if needed'''\n        pass\n    \n    def run_robot(self, command: str, timeout: int = 30) -\u003e dict:\n        '''Run bv in robot mode and return JSON'''\n        # bv --robot-insights\n        # bv --robot-plan\n        # bv --robot-priority\n        pass\n    \n    def start_tui(self) -\u003e bool:\n        '''Start TUI in background terminal'''\n        pass\n    \n    def stop_tui(self):\n        '''Stop TUI process'''\n        pass\n```\n\n## Dependencies\n- Task: Install bv binary\n\n## Acceptance\n- [ ] BvManager class hoạt động\n- [ ] run_robot() returns parsed JSON\n- [ ] Proper error handling với timeout","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T19:35:15.9909861+07:00","updated_at":"2025-12-09T19:40:35.5894395+07:00","closed_at":"2025-12-09T19:40:35.5894395+07:00","dependencies":[{"issue_id":"mcp-beads-village-xjs","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:35:16.1450074+07:00","created_by":"daemon"}]}
{"id":"mcp-beads-village-zo8","title":"Update documentation for bv integration","description":"## Task\nUpdate documentation với bv integration\n\n## Files to Update\n1. **README.md** - Add bv integration section\n2. **AGENTS.md** - Add bv tools usage\n3. **AGENTS-LITE.md** - Add bv tools quick reference\n4. **docs/SETUP.md** - Add bv installation instructions\n\n## New Content\n\n### README.md\n```markdown\n## Beads Viewer Integration (Optional)\n\nInstall `bv` for advanced graph analysis and TUI dashboard:\n\n```bash\n# Install bv\ngo install github.com/Dicklesworthstone/beads_viewer/cmd/bv@latest\n\n# Or download binary from releases\n```\n\n### New Tools (when bv available)\n| Tool | Description |\n|------|-------------|\n| `bv_insights` | Graph analysis (bottlenecks, cycles) |\n| `bv_plan` | Parallel execution tracks |\n| `bv_priority` | Priority recommendations |\n| `bv_tui` | Launch TUI dashboard |\n```\n\n## Dependencies\n- All implementation tasks completed\n\n## Acceptance\n- [ ] README updated\n- [ ] AGENTS.md updated\n- [ ] docs/SETUP.md updated","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T19:36:02.5870661+07:00","updated_at":"2025-12-09T19:46:44.8903018+07:00","closed_at":"2025-12-09T19:46:44.8903018+07:00","dependencies":[{"issue_id":"mcp-beads-village-zo8","depends_on_id":"mcp-beads-village-2ks","type":"discovered-from","created_at":"2025-12-09T19:36:02.7956487+07:00","created_by":"daemon"}]}
